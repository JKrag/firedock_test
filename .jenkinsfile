// Add env variables
// Build image
// Run image
// End-to-end test

node {
	stage('checkout'){
		checkout scm
	}
	stage('build docker image'){
		sh 'docker build --build-arg root="master" -t fiery-test:latest . '
	}
node {
	stage("run docker"){
		sh 'docker container run --name mylittlefiery --rm -p 8000:8080 fiery-test'
	}
}
node {
		try {		
			sh 'sleep 5'
			sh 'curl http://127.0.0.1:8000/master/hello/world/'
		} catch (e) {
			currentBuild.result = 'FAILURE'
			throw e
		} finally {
			sh "docker container kill mylittlefiery"
		}
	}
}